<html>
<head>
<title>WebSockets Demo</title>
<meta charset = "utf-8" />

<style>

body {
	font-family: 'Liberation Sans';
	font-size: 22px;
}

</style>

<script language = "javascript" type = "text/javascript">

var websock = new WebSocket("ws://localhost:1976/");

websock.onopen = function () {
	var freq = document.getElementById("spin");

	console.log("Connected");
	send_msg(freq.value);
};

websock.onclose = function () {
	console.log("Connection closed");
	websock.close();
};

websock.onerror = function () {
	console.log("Error");
};

websock.onmessage = function (m) {
	var msg = JSON.parse(m.data);
	console.log(m.data);
	document.getElementById("host").innerHTML = msg.host;
	document.getElementById("uptime").innerHTML = msg.uptime;
	document.getElementById("rxb").innerHTML = msg.rx;
	document.getElementById("txb").innerHTML = msg.tx;
};

function send_msg (freq) {
	websock.send(freq);
};

function spinner (direction) {
	var freq = document.getElementById("spin");

	if (direction == "inc")
		freq.value++;
	else if (direction == "dec" && freq.value > 0)
		freq.value--;
	else
		return;

	send_msg(freq.value);
};

window.onbeforeunload = function() {
	websock.close();
};

</script>
</head>

<body>

<center>
	<big>WebSockets Demo</big>
	<p />
	<big><b><span id = "host"></span></b></big>
</center>

<br /><br />

<center>
<table>
<tbody>
	<tr>
		<td align = "right"><b>Uptime : </b></td>
		<td align = "left"><span id = "uptime"></span></td>
	</tr>
	<tr>
		<td align = "right"><b>RX bytes : </b></td>
		<td align = "left"><span id = "rxb"></span></td>
	</tr>
	<tr>
		<td align = "right"><b>TX bytes : </b></td>
		<td align = "left"><span id = "txb"></span></td>
	</tr>
</tbody>
</table>
</center>

<p />

<center>
<small>Set update frequency <small>(seconds)</small></small>
<p />
<input type = "text" id = "spin" size = "2" value = "2" readonly />
<button type = "button" onclick = "spinner('inc');">&#11014;</button>
<button type = "button" onclick = "spinner('dec');">&#11015;</button>
<br />
<small><small>0 disables updates</small></small>
</center>

</body>
</html>
